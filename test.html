<html>
  <head>
    <script src="//www.google.com/jsapi"></script>
    <script>
      window.parent.maeExportApis_();
    </script>

    <base target="_top" />
    <style>
      table,
      th,
      td {
        border: 1px solid black;
        border-collapse: collapse;
      }

      th {
        text-align: left;
      }

      #message,
      #url {
        color: red;
      }

      div#footer {
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <table>
      <tbody>
        <tr>
          <th>Version</th>
          <td>
            <div>
              <input type="radio" id="ver97" name="version" value="v10.0" />
              <label for="ver97">v10.0</label>
            </div>
            <div>
              <input type="radio" id="ver98" name="version" value="v10.1" />
              <label for="ver98">v10.1</label>
            </div>
            <div>
              <input type="radio" id="verXX" name="version" value="vX.X" />
              <label for="verXX">vX.X</label>
            </div>
          </td>
        </tr>

        <tr>
          <th>Feature's name</th>
          <td>
            <input type="text" name="featureName" id="featureName" />
          </td>
        </tr>

        <tr>
          <th>Folder URL</th>
          <td>
            <input type="text" name="folderUrl" id="folderUrl" />
          </td>
        </tr>

        <tr>
          <th>Template</th>

          <td>
            <div>
              <input
                type="radio"
                id="checklist"
                name="templateType"
                value="1"
              />
              <label for="checklist">Check list file</label>
            </div>
            <div>
              <input
                type="radio"
                id="outlineDesign"
                name="templateType"
                value="2"
              />
              <label for="outlineDesign">Outline design file</label>
            </div>
            <div>
              <input
                type="radio"
                id="detailDesign"
                name="templateType"
                value="3"
              />
              <label for="detailDesign">Detail design file</label>
            </div>
            <div>
              <input type="radio" id="test" name="templateType" value="4" />
              <label for="test">Test specification file</label>
            </div>
          </td>
        </tr>

        <tr>
          <th>Result</th>

          <td>
            <div id="url"></div>
          </td>
        </tr>
      </tbody>
    </table>

    <div id="footer">
      <button id="submitButton" onclick="generate();">Execute</button>

      <div id="message">Please enter the target feature name</div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <script>
      function generate() {
        let folderUrl = $("#folderUrl").val().trim();
        if (folderUrl.length !== 0) {
          generateByFolderUrl(folderUrl);
          return;
        } else {
          generateByFeatureName();
        }
      }

      function generateByFolderUrl(folderUrl) {
        let templateType = parseInt(
          $("input[name='templateType']:checked").val()
        );
        if (!templateType) {
          $("#message").text("Check the template you want to copy");
          return;
        }

        console.log(folderUrl);
        console.log(templateType);

        $("#message").text("");
        $("#submitButton").hide();
        $("#url").text("Generating...");
        google.script.run
          .withSuccessHandler(showUrl)
          .withFailureHandler(showError)
          .executeCopyTemplateByUrl(folderUrl, templateType);
      }

      function generateByFeatureName() {
        let version = $("input[name='version']:checked").val();
        console.log(version);
        if (version === undefined) {
          console.log("Please select a version");
          $("#message").text("Please select a version");
          return;
        }

        let featureName = $("#featureName").val().trim();
        console.log(featureName);
        if (featureName.length === 0) {
          $("#message").text("Please enter the target feature name");
          return;
        }

        let templateType = parseInt(
          $("input[name='templateType']:checked").val()
        );
        if (!templateType) {
          $("#message").text("Check the template you want to copy");
          return;
        }

        $("#message").text("");
        $("#submitButton").hide();
        $("#url").text("Generating...");
        console.log(templateType);
        google.script.run
          .withSuccessHandler(showUrl)
          .withFailureHandler(showError)
          .executeCopyTemplate(version, featureName, templateType);
      }

      function showUrl(url) {
        console.log(url);
        $("#url").html(
          `<a href="${url}" target="_blank">URL of the template file generated by copying</a>`
        );
        $("#submitButton").show();
      }

      function showError(error) {
        console.log(error);
        window.alert(
          "An error has occurred. You can check it in the console tab of the development tool"
        );
      }
    </script>
  </body>
</html>
